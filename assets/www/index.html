<!DOCTYPE HTML>
<!-- https://github.com/jcrowson/Android-Phonegap-Screenshot-Plugin -->
<!-- http://html2canvas.hertzen.com/screenshots.html -->
<html>
  <head>
    <title>PhoneGap</title>
    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.0/jquery.mobile-1.0.min.css" />
    <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Impact">
    <link rel="stylesheet" href="css/style.css" />
	<script src="http://code.jquery.com/jquery-1.6.4.min.js"></script>
	<script src="http://code.jquery.com/mobile/1.0/jquery.mobile-1.0.min.js"></script>
	<script type="text/javascript" charset="utf-8" src="phonegap-1.3.0.js"></script>      
	<script type="text/javascript" charset="utf-8" src="js/functions.js"></script>	
        <script type="text/javascript" src="js/html2canvas.js"></script>
        <script type="text/javascript" src="js/jquery.plugin.html2canvas.js"></script>
        <script type="text/javascript">             
            var proxyUrl = "http://html2canvas.appspot.com";
            $(function(){
                var iframe,d;
                $('#b-generate').click(function(){
                    var url = "http://www.google.com";
                    $('#content').append($('<img />').attr('src','img/img-thing.jpg').css('margin-top',40));                    
                    var urlParts = document.createElement('a');
                    urlParts.href = url;                    
                    $.ajax({
                        data: {
                            xhr2:false,
                            url:urlParts.href                            
                        },
                        url: proxyUrl,
                        dataType: "jsonp",
                        success: function(html){
                            iframe = document.createElement('iframe');
                            $(iframe).css({
                                'visibility':'hidden'
                            }).width(300).height(300);
                            $('#content').append(iframe);
                            d = iframe.contentWindow.document;
                            d.open();                            
                            $(iframe.contentWindow).load(function(){
                                var date = new Date();
                                var message,
                                timeoutTimer,
                                timer = date.getTime();
                                var body = $(iframe).contents().find('body')[0];
                                var preload = html2canvas.Preload(body, {
                                    "complete": function(images){                
                                        var queue = html2canvas.Parse(body, images);
                                        var canvas = $(html2canvas.Renderer(queue));
                                        var finishTime = new Date();
                                     $("#content").empty().append(canvas);
                                   }
                                });
                                    });									
                                    $('base').attr('href',urlParts.protocol+"//"+urlParts.hostname+"/");
                                    var base = "<base href='"+urlParts.protocol+"//"+urlParts.hostname+"/' />";
                                    var headIdx = html.indexOf('<head');
                                    var endHeadIdx = html.indexOf('>', headIdx);
                                    html = html.substring(0, endHeadIdx + 1) + base + html.substring(endHeadIdx + 1);
                                    d.write(html);
                                    d.close();                         
                                }       
                            });
                        });
                    });
        </script>	
  </head>
  <body onload="onLoad();">  
  <div id="principal"> 
  <div id="title">Babuino te dice...</div> 
  	<div id="text">
	  	<div id ="text-top" class="text header" ></div>
	  	<div id ="text-bottom" class="text" ></div>
  	</div>
  	<div id="imagen"></div>
  </div>
  <div id="buttons" style="text-align: center;">
		<button id="b-left" data-inline="true" data-icon="arrow-l" data-theme="c">Prev</button>
		<button id="b-generate" data-inline="true" data-icon="check" data-theme="e">Share</button>
		<button id="b-right" data-inline="true" data-icon="arrow-r" data-iconpos="right" data-theme="c">Next</button>
  </div>
  <div id="content"></div>
  </body>
</html>
